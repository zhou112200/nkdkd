<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>MobileNet å®æ—¶å›¾åƒåˆ†ç±» Demo</title>
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
  <!-- MobileNet æ¨¡å‹ -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
  <style>
    body { text-align: center; font-family: sans-serif; }
    video { border: 1px solid #ccc; margin-top: 10px; }
    #result { margin-top: 15px; font-size: 18px; font-weight: bold; color: #333; }
  </style>
</head>
<body>
  <h1>ğŸ“· MobileNet å®æ—¶åˆ†ç±»</h1>
  <video id="webcam" autoplay playsinline muted width="400" height="300"></video>
  <div id="result">â³ æ­£åœ¨åŠ è½½æ¨¡å‹...</div>

  <script>
    const video = document.getElementById("webcam");
    const resultEl = document.getElementById("result");
    let model;

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" } // é»˜è®¤ç”¨åç½®æ‘„åƒå¤´
      });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => resolve(video);
      });
    }

    async function init() {
      try {
        await setupCamera();
        model = await mobilenet.load();
        resultEl.textContent = "âœ… æ¨¡å‹åŠ è½½å®Œæˆï¼Œæ­£åœ¨è¯†åˆ«...";
        detectFrame();
      } catch (err) {
        console.error(err);
        resultEl.textContent = "âŒ å‡ºé”™ï¼š" + err.message;
      }
    }

    async function detectFrame() {
      if (!model) return;
      const predictions = await model.classify(video);

      resultEl.innerHTML = predictions.map(
        p => `${p.className} (${(p.probability * 100).toFixed(1)}%)`
      ).join("<br>");

      requestAnimationFrame(detectFrame); // ä¸‹ä¸€å¸§ç»§ç»­
    }

    init();
  </script>
</body>
</html>
