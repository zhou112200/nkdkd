<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>MobileNet 实时图像分类 Demo</title>
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
  <!-- MobileNet 模型 -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
  <style>
    body { text-align: center; font-family: sans-serif; }
    video { border: 1px solid #ccc; margin-top: 10px; }
    #result { margin-top: 15px; font-size: 18px; font-weight: bold; color: #333; }
  </style>
</head>
<body>
  <h1>📷 MobileNet 实时分类</h1>
  <video id="webcam" autoplay playsinline muted width="400" height="300"></video>
  <div id="result">⏳ 正在加载模型...</div>

  <script>
    const video = document.getElementById("webcam");
    const resultEl = document.getElementById("result");
    let model;

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" } // 默认用后置摄像头
      });
      video.srcObject = stream;
      return new Promise(resolve => {
        video.onloadedmetadata = () => resolve(video);
      });
    }

    async function init() {
      try {
        await setupCamera();
        model = await mobilenet.load();
        resultEl.textContent = "✅ 模型加载完成，正在识别...";
        detectFrame();
      } catch (err) {
        console.error(err);
        resultEl.textContent = "❌ 出错：" + err.message;
      }
    }

    async function detectFrame() {
      if (!model) return;
      const predictions = await model.classify(video);

      resultEl.innerHTML = predictions.map(
        p => `${p.className} (${(p.probability * 100).toFixed(1)}%)`
      ).join("<br>");

      requestAnimationFrame(detectFrame); // 下一帧继续
    }

    init();
  </script>
</body>
</html>
